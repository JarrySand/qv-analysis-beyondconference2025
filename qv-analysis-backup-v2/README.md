# QV分析

二次投票（Quadratic Voting, QV）データを処理・分析するためのツールキット。

## 概要

このリポジトリには、二次投票データを分析するためのPythonスクリプト集が含まれています。システムは生のJSON投票データを処理し、CSV形式に変換した上で、基本統計、投票方法の比較、感度分析、「埋もれた声」の分析など、様々な分析を実行します。特に、二次投票（QV）と従来の一人一票方式の違いを明確にする比較分析に重点を置いています。

## 主な機能

- プロジェクト名翻訳の一元管理システム
- JSONから標準CSV形式への変換
- 二次投票データの複数分析メソッド
- 投票パターンと「埋もれた声」の可視化
- **二次投票と一人一票方式の詳細比較分析**
- パラメータ調整のための感度分析
- 中立バイアスのシミュレーションと分析

## プロジェクト構造

```
qv-analysis/
├── data/                          # データファイル
│   ├── candidates.csv             # 英語翻訳付きの候補者情報
│   ├── election.json              # 元の投票データ（JSON形式）
│   ├── project_name_mapping.csv   # プロジェクト名の日英マッピング
│   ├── vote_summary.csv           # 投票サマリーデータ
│   └── votes.csv                  # 変換済み投票データ
│
├── docs/                          # ドキュメント
│   ├── assets/                    # ウェブサイト用アセット
│   │   ├── css/                   # スタイルシート
│   │   ├── images/                # 画像ファイル
│   │   └── js/                    # JavaScript
│   └── index.html                 # 分析結果公開サイト
│
├── results/                       # 分析結果
│   ├── data/                      # 生成されたデータファイル
│   │   ├── buried_voices.csv
│   │   ├── vote_statistics.csv
│   │   ├── one_person_one_vote_results.csv  # 一人一票シミュレーション結果
│   │   ├── voting_methods_comparison.csv    # 投票方式比較データ
│   │   └── ...
│   ├── figures/                   # 生成されたグラフ
│   │   ├── basic_analysis/        # 基本分析グラフ
│   │   ├── comparison/            # 比較分析グラフ
│   │   │   ├── voting_methods_vote_comparison.png      # 投票数比較
│   │   │   ├── voting_methods_budget_comparison.png    # 予算配分比較
│   │   │   ├── voting_methods_percentage_comparison.png # パーセンテージ比較
│   │   │   ├── voting_methods_gini_comparison.png      # 不平等度比較
│   │   │   ├── voting_methods_lorenz_curve.png         # ローレンツ曲線
│   │   │   └── preference_intensity_comparison.png     # 選好強度比較
│   │   └── neutral_bias/          # 中立バイアス分析グラフ
│   ├── reports/                   # 分析レポート
│   │   ├── credit_usage_report.md
│   │   ├── FINDINGS.md
│   │   ├── voting_methods_comparison_report.txt  # 投票方式比較レポート
│   │   └── ...
│   └── tables/                    # 生成されたテーブル
│       ├── budget_allocation_table.txt
│       └── statistics_report.txt
│
├── src/                           # ソースコード
│   ├── analysis/                  # 分析スクリプト
│   │   ├── analyze_votes.py       # 基本投票分析
│   │   ├── buried_voices_analyzer.py
│   │   ├── buried_voices_probabilistic.py
│   │   ├── buried_voices_visualizer.py
│   │   ├── compare_voting_methods.py  # 投票方式比較スクリプト
│   │   ├── generate_statistics.py
│   │   ├── sensitivity_analysis.py
│   │   └── vote_distribution_analyzer.py
│   │
│   ├── simulation/                # シミュレーションスクリプト
│   │   ├── comparison/            # 投票方式比較
│   │   │   └── simulate_unbiased_voting.py  # 一人一票シミュレーション
│   │   └── neutral_bias/          # 中立バイアス分析
│   │       ├── analyze_credit_usage.py
│   │       ├── analyze_vote_patterns.py
│   │       ├── bias_simulator_base.py
│   │       ├── fixed_rate_simulator.py
│   │       ├── identify_voting_patterns.py
│   │       └── simulate_utility_max_model.py
│   │
│   └── utils/                     # ユーティリティスクリプト
│       ├── check_duplicate_votes.py
│       ├── convert_to_csv.py      # データ変換ユーティリティ
│       └── count_voters.py
│
├── candidate_name_change_workflow.md  # 候補者名変更の手順
├── requirements.txt                  # 必要なPythonパッケージリスト
├── run_all_analysis.py               # 完全な分析パイプラインを実行
└── run_data_processing.py            # データ変換ステップのみを実行
```

## 使い方

### 前提条件

- Python 3.6+

### インストール

1. リポジトリをクローン
2. 必要な依存パッケージをインストール:
   ```
   pip install -r requirements.txt
   ```

### 使用方法

#### 完全な分析の実行

分析パイプライン全体を実行するには:

```
python run_all_analysis.py
```

これにより、以下のスクリプトが正しい順序で実行されます:
1. データ変換（JSONからCSV）
2. 基本投票分析
3. 埋もれた声の可視化
4. 統計分析
5. 埋もれた声の確率論的分析
6. **投票方法の比較**（二次投票 vs 一人一票）
7. 投票分布分析
8. 埋もれた声の詳細分析
9. 感度分析

#### データ処理のみの実行

分析を実行せずにデータを処理するには:

```
python run_data_processing.py
```

これは、候補者名を更新し、CSVファイルを再生成する必要がある場合に便利です。

### プロジェクト名の変更

プロジェクト名の翻訳を変更するには:

1. `data/candidates.csv` を編集して英語訳を更新
2. `python run_data_processing.py` を実行して変更を反映
3. 生成されたCSVファイルに変更が反映されていることを確認

詳細については、`candidate_name_change_workflow.md` を参照してください。

## 分析手法

- **基本投票分析**: 投票パターンと分布を調査
- **埋もれた声分析**: 少数派からの強い支持を持つプロジェクトを特定
- **投票方法比較**: QVと他の投票システムを対比
- **感度分析**: パラメータ変更が結果にどう影響するかをテスト
- **中立バイアス分析**: 理想的な投票モデルとの比較によるバイアス検出

## プロジェクト概要

このプロジェクトは、Quadratic Voting（二次投票）の投票結果を分析するためのツールです。ソーシャルセクターの若手起業家を対象としたイベントでの投票データを分析し、効果的な資金配分をサポートします。

## イベント詳細

- **対象**: ソーシャルセクターの若手起業家
- **イベント名**: Beyond Conference 2025
- **開催日**: 2025年4月26日
- **開催場所**: 淡路島
- **投票形式**: ピッチプレゼン後にオーディエンスによるリアルタイム投票
- **投票者**: 他のソーシャルセクター起業家、自治体職員、企業CSR担当者など
- **賞金**: 投票結果に応じて25万円のプール資金が提供される
- **使用ツール**: [qv.geek.sg](https://qv.geek.sg)
- **投票リンク**: https://api.qv.geek.sg/election/0a9885d5-43b4-4b80-b69f-406092002a38
- **投票UID**: 0a9885d5-43b4-4b80-b69f-406092002a38

## 分析目的

このプロジェクトでは、Quadratic Votingによる投票データを分析し、以下の点を明らかにします：

1. 各プロジェクトの支持度合い
2. 投票パターンの分析
3. 資金配分の最適化提案
4. 投票行動における潜在的バイアスの特定
5. **二次投票と一人一票方式の実質的な違いと影響**

## 技術スタック

- データ収集: 
  - qv.geek.sgのAPIエンドポイント (`https://api.qv.geek.sg/election/{uid}`) からのデータ取得
  - 投票結果はJSONファイルとして保存済み
- データ分析: Python (pandas, numpy, scipy)
- 可視化: matplotlib, seaborn, plotly

## 主な機能

- 投票データ（election.json）のCSV形式への変換
- 投票パターンの分析
- 予算配分の計算（二次投票方式）
- 統計レポート生成（CSV、テキスト、HTML形式）
- データ可視化（棒グラフ、円グラフ）
- 投票方式の比較シミュレーション（QV vs 一人一票方式）
- 中立バイアスシミュレーション（理想的効用最大化モデル）

## 投票分析モデル

### 二次投票と一人一票方式の比較分析

本プロジェクトの中核は、二次投票（QV）と従来の一人一票方式の詳細な比較分析です。この比較により、各投票方式の特性と結果への影響を明らかにします：

1. **投票方式変換シミュレーション**：
   - 実際の二次投票データから「各投票者が最も強く支持するプロジェクトに1票を投じる」という一人一票方式をシミュレート
   - 同じ有権者集団による両方式の結果を直接比較

2. **比較指標**：
   - **得票数の違い**：各プロジェクトの得票数の変化を視覚化
   - **予算配分の差異**：資金配分パターンの変化を分析
   - **ジニ係数による不平等度測定**：資源配分の公平性を計量的に評価
   - **ローレンツ曲線**：資源配分の集中度を可視化
   - **選好強度の表現度**：強い選好がどれだけ結果に反映されるかを分析

3. **一人一票方式の制約**：
   - 投票者が複数のプロジェクトを支持できない制約
   - 支持の強さを表現できない制約
   - 少数派の強い選好が結果に反映されにくい問題

4. **検証結果の視覚化**：
   - 各種比較グラフによる直感的な理解促進
   - 両方式間の乖離が大きいプロジェクトの特定
   - 選好強度ヒートマップによる支持パターンの可視化

5. **埋もれた声の比較**：
   - 二次投票で浮き彫りになる少数派の強い支持が、一人一票方式でどのように埋もれてしまうかを分析
   - 両方式間の「埋もれた声」の差異を定量的に評価

この比較分析により、二次投票方式が従来の投票方式と比較してどのような利点と課題を持つのか、特に資金配分の公平性と少数派の声の反映において、どのような違いをもたらすのかを明らかにします。

### 中立バイアス分析

このプロジェクトでは、実際の投票行動と理論的に理想的な投票行動（効用最大化モデル）を比較することで、投票における中立バイアスを分析します：

1. **効用最大化モデル**: 各投票者が自分の効用を最大化するよう理想的に投票すると仮定したシミュレーション
2. **信用利用率分析**: 投票者が利用可能な全信用を使用する割合の調査
3. **小さな投票値の分布**: 1点や0点の投票パターンとその理由の分析
4. **投票パターンクラスタリング**: 類似した投票行動を示すグループの特定

これらの分析により、理想と現実の投票パターンの乖離、投票行動の最適化機会、そして二次投票システムの設計改善点を特定します。

### その他の分析モデル

- **確率論的埋もれた声分析**: 少数派の強い支持を持つプロジェクトの特定
- **投票方法比較シミュレーション**: 二次投票と一人一票方式の比較
- **感度分析**: パラメータ変更による結果への影響評価

## 分析結果の公開サイト

QV投票方式と一人一票方式の比較分析結果を[インタラクティブなウェブサイト](https://tkgshn.github.io/qv-analysis-beyondconference2025/)で公開しています。このサイトでは、以下の比較結果をインタラクティブに確認できます：

- **投票数比較グラフ**: 両方式での各プロジェクトの得票数差異
- **予算配分比較**: 資金配分の違いを視覚化
- **不平等度指標**: ジニ係数による資源配分の公平性評価
- **ローレンツ曲線**: 資源配分の集中度の視覚的比較
- **選好強度ヒートマップ**: 投票者の選好強度パターン

二次投票方式では、選好の強さを反映し、少数派の声も予算配分に影響を与えられる一方、一人一票方式では投票数の多いプロジェクトに資源が集中する傾向を明確に確認できます。

## 依存ライブラリ

プロジェクトを実行するために必要なライブラリは、`requirements.txt` に記載されています。主な依存ライブラリは以下の通りです：

- pandas: データ処理とCSV操作
- numpy: 数値計算
- scipy: 統計分析
- matplotlib: 静的グラフ生成
- seaborn: 高度な統計可視化
- scikit-learn: クラスタリングと機械学習
- plotly: インタラクティブグラフ
- statsmodels: 統計モデル