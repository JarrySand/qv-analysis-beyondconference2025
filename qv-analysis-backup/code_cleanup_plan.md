# コード整理計画

ディレクトリ構造を再編成する前に、現在のコードベースに存在する重複や古いバージョンのファイルを整理する必要があります。この文書では、識別された重複コードと、それらを整理するための計画を概説します。

## 識別された重複/更新コード

| 旧ファイル | 更新/代替ファイル | 状態 | 推奨アクション |
|------------|-------------------|------|----------------|
| `buried_voices_visualizer.py` | `fix_buried_voices_visualizer.py` | 更新あり - アルゴリズム改善 | `fix_` バージョンを残し、元ファイルを削除または archive |
| `analyze_votes.py` | `analyze_votes_buried.py` | 可能性あり - 機能拡張/特化 | 両方のコード内容を確認し、統合または特化版として維持 |
| `simulate_unbiased_voting.py` | `neutral_bias_simulation/simulate_utility_max_model.py` | 可能性あり - 機能拡張 | 両方の機能を確認し、最新版を残す |
| `analyze_vote_distribution.py` | `neutral_bias_simulation/analyze_vote_distribution.py` | 可能性あり - 異なる分析対象 | 機能の違いを確認し、適切に名前を変更して両方維持 |

## 確認が必要なディレクトリ間の重複

以下のディレクトリ間で機能の重複やファイルの重複がある可能性があります：

1. ルートディレクトリと `neutral_bias_simulation/` の間の重複分析スクリプト
2. `output/`, `analysis_output/`, `analysis_results/` 間の出力データ/画像の重複
3. `docs/assets/images/` と他の画像ディレクトリ間の重複画像ファイル
4. `comparison_simulation/` 内の分析スクリプトとルートディレクトリのスクリプトの重複

## コード整理の手順

### 1. 重複ファイルの詳細分析

- 各ファイルペアの内容を比較し、最新バージョンを特定
  - 更新日時の確認
  - コード内のコメントやバージョン情報の確認
  - 機能の改善や拡張の有無
- ファイル間の依存関係を特定
  - 他のスクリプトから呼び出されているか
  - インポートされているモジュールの違い

### 2. ファイル命名規則の統一

- 特殊なプレフィックス（`fix_`など）を削除
- 機能に応じた一貫性のある命名規則を適用
  - 分析スクリプトは `analyze_` プレフィックス
  - シミュレーションスクリプトは `simulate_` プレフィックス
  - 可視化スクリプトは `visualize_` プレフィックス
- ファイル名から明確な目的がわかるようにする

### 3. コードの統合と削除

- 最新バージョンを残し、古いバージョンを削除または archive ディレクトリに移動
- 関連する機能は可能な限り単一スクリプトに統合
- 重複するロジックを共通のユーティリティ関数に抽出
- 出力先パスの標準化（すべてのスクリプトで一貫したパス構造を使用）

### 4. 特定のファイル対応計画

#### buried_voices_visualizer.py の処理

1. `fix_buried_voices_visualizer.py` の内容を確認
2. 改善されたアルゴリズム（「vote_value >= 4 and i != max_candidate」）を採用
3. `buried_voices_visualizer.py` として保存（`fix_` プレフィックスなし）
4. 古いバージョンを削除または archive

#### 分析スクリプトの整理

1. `analyze_votes.py` と `analyze_votes_buried.py` の機能を比較
2. 重複している場合は統合し、異なる目的の場合は名前を明確化
3. 同様に他の分析スクリプト間の関係を確認

### 5. ドキュメント更新

- 変更内容を記録するための簡単な CHANGELOG.md を作成
- 各スクリプトの先頭にコメントを追加（目的、依存関係、最終更新）
- 主要なモジュールの関係を示す簡単な図を作成

## タイムライン

1. **Day 1**: 重複ファイルの詳細分析と計画確定
2. **Day 2**: 重要なスクリプトの更新と統合
3. **Day 3**: 残りのスクリプト整理とテスト
4. **Day 4**: ドキュメント更新とレビュー

## 注意点

- 変更前に各ファイルのバックアップを作成する
- 変更後は影響を受ける可能性のあるスクリプトをテストする
- すべての変更を Git でコミットし、明確なコミットメッセージを残す 