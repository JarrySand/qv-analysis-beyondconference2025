# 理論的投票分布分析 - 全体計画書
## Quadratic Voting における投票分布の理論的導出

---

## 🎯 問題設定

### 基本パラメータ
- **プロジェクト数**: n = 7
- **投票者数**: 無限大（大数の法則適用可能）
- **クレジット制約**: 各投票者99クレジット
- **投票システム**: Quadratic Voting（コスト = 投票数²）
- **選好分布**: 各投票者の各プロジェクトへの選好 $u_{ij} \sim N(\mu, \sigma^2)$

### 理論的目標
実際のデータとは**完全に独立**して、上記条件下での理論的投票分布を**ラグランジュ関数による解析的手法**で数学的に導出する。

### アプローチ
- **シミュレーション不使用**: 数値計算やモンテカルロ法に依存しない
- **純粋解析的**: ラグランジュ乗数法による厳密な数学的証明
- **閉形式解**: 可能な限り解析的な閉形式解を求める

---

## 📋 全体作業計画

### Phase 1: ラグランジュ解析による厳密解
#### 1.1 最適化問題の定式化
- [ ] 個人の効用最大化問題: $\max U_i = \sum_{j=1}^7 u_{ij}\sqrt{v_{ij}}$
- [ ] 制約条件: $\sum_{j=1}^7 v_{ij}^2 \leq 99$, $v_{ij} \geq 0$
- [ ] ラグランジュ関数の構築

#### 1.2 KKT条件による解析解
- [ ] 1次条件（定常条件）の導出
- [ ] 相補スラック条件の適用
- [ ] 内点解の閉形式解: $v_{ij}^* = u_{ij}^{2/3} \left(\frac{99}{\sum_k u_{ik}^{4/3}}\right)^{1/2}$
- [ ] 境界解（0票）の条件: $u_{ij} < \text{threshold}$

#### 1.3 数学的証明の完成
- [ ] 解の一意性の証明
- [ ] 2次条件（十分条件）の確認
- [ ] 制約条件の満足性の証明

### Phase 2: 解析的確率論
#### 2.1 選好分布の解析的特性
- [ ] 正規分布 $N(\mu, \sigma^2)$ の解析的モーメント
- [ ] べき乗モーメント $E[u^{2/3}]$, $E[u^{4/3}]$ の解析的計算
- [ ] 切断正規分布（$u \geq 0$）の解析的扱い

#### 2.2 投票数分布の解析的導出
- [ ] 変数変換 $v = u^{2/3} \cdot \text{scale}$ の解析的処理
- [ ] ヤコビアンの計算と確率密度関数の導出
- [ ] 投票数の期待値・分散の解析的表現

#### 2.3 集計統計量の解析的計算
- [ ] プロジェクトあたりの期待投票数の解析式
- [ ] 投票者あたりの期待投票プロジェクト数の解析式
- [ ] 0票確率の解析的表現

### Phase 3: 解析解の数値評価（必要最小限）
#### 3.1 解析式の数値評価
- [ ] べき乗モーメントの解析式の数値評価
- [ ] 確率密度関数の解析式の数値評価
- [ ] 特殊関数（ガンマ関数等）の高精度計算

#### 3.2 解析的感度分析
- [ ] μ（選好平均）に対する解析的偏微分
- [ ] σ（選好標準偏差）に対する解析的偏微分
- [ ] パラメータ変化の解析的表現

#### 3.3 理論結果の整理
- [ ] 基準ケース（μ=5, σ=2）での解析的理論値
- [ ] 解析解の数学的性質の整理
- [ ] 主要統計量の解析的表現

### Phase 4: 拡張分析
#### 4.1 異質性の考慮
- [ ] プロジェクト間での選好平均の違い
- [ ] 投票者間での選好分散の違い
- [ ] 相関のある選好構造

#### 4.2 行動経済学的拡張
- [ ] リスク回避パラメータの導入
- [ ] 認知制約の考慮
- [ ] 参照点依存性

#### 4.3 システム設計への含意
- [ ] 最適クレジット配分
- [ ] 最適プロジェクト数
- [ ] 投票システムの改善提案

---

## 🔧 実装計画

### 使用ツール・言語
- **数式処理**: SymPy（解析的計算）
- **数学的証明**: 手計算 + LaTeX記述
- **数値評価**: Python (NumPy, SciPy)（解析式の評価のみ）
- **レポート**: Markdown + LaTeX数式

### ファイル構成
```
theoretical_analysis/
├── mathematical_proofs/
│   ├── lagrange_optimization.md    # ラグランジュ法による最適化
│   ├── analytical_solution.md      # 解析解の導出
│   ├── probability_theory.md       # 確率論的分析
│   └── mathematical_appendix.md    # 数学的補足
├── symbolic_computation/
│   ├── sympy_derivation.py         # SymPyによる解析的計算
│   ├── moment_calculation.py       # モーメントの解析的計算
│   └── analytical_evaluation.py    # 解析式の数値評価
├── results/
│   ├── theoretical_formulas.md     # 導出された理論式
│   ├── analytical_values.csv       # 解析的理論値
│   └── sensitivity_analysis.md     # 解析的感度分析
└── verification/
    ├── formula_verification.py     # 解析式の検証
    └── consistency_check.py        # 一貫性チェック
```

---

## 📊 期待される成果物

### 1. 数学的成果
- **解析解**: 最適投票数の閉形式解
- **分布関数**: 投票数の確率密度関数
- **モーメント**: 期待値、分散、高次モーメント

### 2. 数値的成果
- **理論値**: 基準パラメータでの具体的な数値
- **感度分析**: パラメータ変化に対する理論値の変化
- **分布図**: 理論分布の可視化

### 3. 理論的洞察
- **投票パターン**: 理論的に予測される投票行動
- **システム特性**: QVシステムの理論的性質
- **設計含意**: システム改善への示唆

---

## ⏰ 作業スケジュール

### Week 1: 数学的基礎
- Day 1-2: 最適化問題の定式化と解析解導出
- Day 3-4: 確率論的分析の基礎
- Day 5-7: 理論公式の検証と整理

### Week 2: 数値計算
- Day 1-3: 数値積分とモンテカルロ実装
- Day 4-5: 基準ケースでの計算実行
- Day 6-7: 結果の検証と可視化

### Week 3: 拡張と総合化
- Day 1-3: 感度分析の実行
- Day 4-5: 拡張モデルの検討
- Day 6-7: 最終レポートの作成

---

## 🎯 成功基準

### 数学的厳密性
- [ ] 解析解の数学的正当性が証明されている
- [ ] 数値計算の精度が十分高い（相対誤差 < 0.1%）
- [ ] 理論と数値の一致が確認されている

### 実用的価値
- [ ] 明確な理論予測が得られている
- [ ] パラメータの影響が定量化されている
- [ ] システム設計への具体的示唆がある

### 再現可能性
- [ ] 全ての計算が再現可能である
- [ ] コードが十分にドキュメント化されている
- [ ] 結果の解釈が明確である

---

## 📚 参考文献・理論的基盤

### 数学的基礎
- 最適化理論（KKT条件、制約付き最適化）
- 確率論（変数変換、モーメント生成関数）
- 数値解析（数値積分、モンテカルロ法）

### 経済学的基盤
- Quadratic Voting理論（Weyl & Posner）
- 効用最大化理論
- メカニズムデザイン

### 統計学的手法
- 正規分布の性質
- べき乗モーメントの計算
- 確率密度関数の変換

---

## ⚠️ 重要な理論的修正

**計画更新**: 本計画書作成後の研究で重要な発見がありました。

**発見された問題**:
- マッチングプール制約下でのNash均衡分析において、「完全均等配分」という結論は理論的に誤りでした
- 各投票者の選好の異質性により、投票パターンは選好を反映して異なるべきです

**修正された研究方向**:
- Phase 1-2の個人最適化理論は正しく、重要な基盤として活用
- Nash均衡分析は異質的選好を考慮した正しいアプローチに修正
- 戦略的均衡モデルの再構築が必要

詳細は `nash_equilibrium_critique.md` を参照してください。

---

*この計画書は理論的投票分布分析の包括的なロードマップです。*
*実際のデータとの比較は別途実施し、純粋な理論分析に集中します。*  
*Updated: 2025-01-12 (Nash equilibrium correction noted)* 